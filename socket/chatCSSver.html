<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <style>
        ::-webkit-scrollbar {
        width: 10px;
        }

        ::-webkit-scrollbar-track {
        border-radius: 10px;
        background-color: rgba(25, 147, 147, 0.1);
        }

        ::-webkit-scrollbar-thumb {
        border-radius: 10px;
        background-color: rgba(25, 147, 147, 0.2);
        }

        @media (min-width: 768px){
            #chat-box {
                width: 768px;
            }
        }

        #chat-box {
            width: 50vw;
            border-radius: 8px;
            justify-content: center;
            align-items: center;

        }

        html {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-list {
            background-color: #C3F8FF;
            border-radius: 8px;
            width: 50vw;
            height: 50vw;
            padding: 10px;
            position: relative;
            overflow-y: scroll;
            overflow-x: hidden;   
        }
        
        input {
            width: 40vw;
        }

        .chat-list div div {
            display: inline-block;
            padding: 3px;
        }

        .my-chat {
            text-align: right;
        }
        
        .footer-outer {
            position: relative;
        }

        .footer-inner {
            position: absolute;        
            bottom: 5px;
        }

        .my-chat div {
            background-color: #FFF6BF;
            position: relative;
            border-radius: 8px;
            /* 10%ë¡œ ì£¼ë‹ˆê¹Œ ì‘ë‹¤ê³ í•´ì„œ pxë¡œ ìˆ˜ì •í•˜ë‹ˆ ì•„ì£¼ ì¢‹ì•„ */
            padding: 5px;
            margin: 5px;
        }

        .my-chat div:after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            width: 0;
            height: 0;
            border: 0.3em solid transparent;
            border-left-color: #FFF6BF;
            border-right: 0;
            margin-top: -0.3em;
            margin-right: -0.3em;
        }

        .other-chat div {
            background-color: #ABD9FF;
            position: relative;
            border-radius: 8px;
            padding: 5px;
            margin: 5px;
            
        }

        .other-chat div:after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 0;
            height: 0;
            border: 0.3em solid transparent;
            border-right-color: #ABD9FF;
            border-left: 0;
            margin-top: -0.3em;
            margin-left: -0.3em;
        }

        .header{
            height: 70px;
            left: 8px;
            right: 8px;
            border-bottom: 1px solid border;
            position: fixed;
            background-color: headerfooter;
            z-index: 1000;
}

    </style>
    <script src="chatCSSver.js"></script>
</head>

<body>
    <div id="chat-box">
        <!-- <section class="header clearfix">
            <div class="back">
                <a href="#">Messages</a>
            </div>
            <div class="username">
                <h1>ğŸŒ±ìƒˆì‹¹í†¡ğŸŒ±</h1>
            </div>
            <div class="contacts">
                <a href="#">Contacts</a>
            </div>
        </section> -->
        <div id="chat-list" class="chat-list">
            <!-- <div class="footer-outer"> -->
                <div class="footer-inner">
                    <select id="nick-list">
                        <!-- ì„ íƒí•  ìˆ˜ ìˆëŠ” ì„ íƒì§€ ì£¼ëŠ” íƒœê·¸ -->
                        <option value="ì „ì²´">ì „ì²´</option>
                    </select>
                    <input type="text" id="message" placeholder="Type something...">
                    <button type="button" onclick="send();">send</button>
                </div>
            <!-- </div> -->
        </div>
    </div>

    <script>
        var nickname = prompt("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        // prompt : alertì°½ì²˜ëŸ¼ ëœ¨ëŠ”ê±´ë° ê°’ì„ ì…ë ¥í•  ìˆ˜ ìˆëŠ” í˜•íƒœ.
        var socket = io.connect();
        socket.emit("info2", { nickname: nickname });
        //40ë²ˆì§¸ ë¼ì¸ì—ì„œ nicknameì„ ë°›ì•„ë’€ì—ˆìŒ.

        var input = document.querySelector('input');
        input.addEventListener('keypress', ({key}) => {
            if (key != 'Enter') {return}
            send();
        }) //JSíŒŒì¼ì— ì ì—ˆë”ë‹ˆ ReferenceError: document is not defined ì—ëŸ¬ ë°œìƒ.

        function send() {
            let msg = document.getElementById("message").value;
            let nick = document.getElementById("nick-list").value;
            socket.emit("send", { msg: msg, to:nick });
            document.getElementById("message").value = "";
        } 

        socket.on("newMessage", function (data) {
            let chat_list = document.getElementById("chat-list");
            let div = document.createElement("div"); 
            let div_chat = document.createElement("div"); 
            let span = document.createElement("span");
            div_chat.textContent = data.msg; 
            
            if (data.is_dm) {
                div_chat.textContent = "(DM)" + div_chat.textContent;
                div_chat.setAttribute('style', "color : salmon");
            }
            if (data.nickname == nickname) { div.classList.add("my-chat");}
            // divì˜ í´ë˜ìŠ¤ì— my-chatì„ ì¶”ê°€í•œë‹¤.
            // <div class="my-chat"></div>
            else {
                span.textContent = data.nickname;
                div.appendChild(span);
                div.classList.add("other-chat");
            }
            
            // div => <div class="my-chat"></div>
            

            div.appendChild(div_chat);
            // <div class="my-chat">
                // <div>{msg}</div>
            // </div>
            chat_list.appendChild(div);
        });

        socket.on("notice", function(data){
            let chat_list = document.getElementById("chat-list");
            let div = document.createElement("div"); // <div></div>
            div.textContent = data;
            div.setAttribute('style', "text-align: center");
            chat_list.appendChild(div);
        });

        socket.on("list", function(list){
            let nick_list = document.getElementById("nick-list");
            while(nick_list.firstChild) {
                nick_list.removeChild(nick_list.lastChild);
            }
            let option = document.createElement("option");
            option.text = "ì „ì²´";
            option.value = "ì „ì²´";
            nick_list.appendChild(option);

            // entries()  
            for(let [key, value] of Object.entries(list)){
                let option = document.createElement("option");
                option.text = value;
                option.value = value;
                nick_list.appendChild(option);
            }
        })
    </script>
</body>

</html>